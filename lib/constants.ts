import type { BusinessPlanData, SimulatorParams } from './types.js';

// ===== Business Constants =====

export const CASH_SHARE_BASE = 0.15;  // 15% of revenue paid in cash (OI/ONU patients)
export const FACT_COST = 0.015;       // 1.5% factoring cost

// ===== Simulator Base Parameters =====

export const SIMULATOR_DEFAULTS: SimulatorParams = {
  consult: 16,
  fee: 225,
  days: 215,
  assoc: 2,
  indep: 3,
  interne: 2,
  start: 4,
  occup: 60,
  cashPct: 15,
  delay: 1,
  factoring: true,
  extra: 200000,
  rc: 60000,
};

// ===== Default Business Plan Data (36 months) =====

export const DEFAULT_BUSINESS_PLAN_DATA: BusinessPlanData = {
  ca: [0,0,0,38313,108554,200617,249316,255982,255982,255982,267157,278332,289506,300681,300681,300681,300681,300681,300681,300681,300681,300681,311855,323030,359747,396463,396463,396463,396463,396463,396463,396463,396463,396463,396463,396463],
  caAssoc: [0,0,0,25542,63855,102168,127710,127710,127710,127710,127710,127710,127710,127710,127710,127710,127710,127710,127710,127710,127710,127710,127710,127710,127710,127710,127710,127710,127710,127710,127710,127710,127710,127710,127710,127710],
  caIndep: [0,0,0,12771,44698,95782,114939,114939,114939,114939,114939,114939,114939,114939,114939,114939,114939,114939,114939,114939,114939,114939,114939,114939,140481,166023,166023,166023,166023,166023,166023,166023,166023,166023,166023,166023],
  caInterne: [0,0,0,0,0,0,0,0,0,0,11175,22349,33524,44698,44698,44698,44698,44698,44698,44698,44698,44698,55873,67048,78222,89397,89397,89397,89397,89397,89397,89397,89397,89397,89397,89397],
  caSage: [0,0,0,0,0,2667,6667,13333,13333,13333,13333,13333,13333,13333,13333,13333,13333,13333,13333,13333,13333,13333,13333,13333,13333,13333,13333,13333,13333,13333,13333,13333,13333,13333,13333,13333],
  result: [0,-17000,-28942,-13755,11069,30233,50341,55758,58758,58758,66724,74691,64057,72023,71023,71023,71023,71023,70857,70440,70440,70440,78406,-13627,87675,106127,106127,106127,106127,106127,105794,105794,105794,105794,105794,5794],
  cashflow: [0,-17000,-45942,-59697,-48627,-18395,31947,87705,146463,205221,271945,346636,410692,482716,553739,624762,695785,766808,837666,908106,978546,1048986,1127393,1113765,1201440,1307568,1413695,1519822,1625949,1732077,1837871,1943665,2049460,2155254,2261048,2266842],
  treso1m: [0,0,0,0,0,-15098,10335,63676,122434,181192,239950,306675,1199115,1263172,1334195,1405218,1476242,1547265,1618122,1688562,1759002,1829442,1899883,1878289,3727941,3815616,3921743,4027870,4133998,4240125,4345919,4451714,4557508,4663302,4769096,4774891],
  treso3m: [0,-17000,-45942,-80534,-126801,-199235,-255632,-272529,-241097,-184755,-125997,-67239,-19115,36976,928416,991473,1062496,1133519,1204376,1274817,1345257,1415697,1486137,1456577,1517834,1587057,3436708,3524383,3630511,3736638,3842432,3948227,4054021,4159815,4265609,4271404],
  admin: [0,0,-8775,-22425,-35100,-44850,-52650,-52650,-52650,-52650,-52650,-52650,-68250,-68250,-68250,-68250,-68250,-68250,-68250,-68250,-68250,-68250,-68250,-68250,-81900,-81900,-81900,-81900,-81900,-81900,-81900,-81900,-81900,-81900,-81900,-81900],
  opex: [0,-17000,-20167,-24167,-26167,-45584,-45584,-45584,-45584,-45584,-45584,-45584,-48584,-48584,-49584,-49584,-49584,-49584,-49750,-50167,-50167,-50167,-50167,-150167,-53667,-53667,-53667,-53667,-53667,-53667,-54000,-54000,-54000,-54000,-54000,-154000],
  lab: [0,0,0,12000,15000,18000,21000,24000,27000,27000,27000,27000,27000,27000,27000,27000,27000,27000,27000,27000,27000,27000,27000,27000,27000,27000,27000,27000,27000,27000,27000,27000,27000,27000,27000,27000],
  fteAssoc: [0,0,0,0,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
  fteIndep: [0,0,0,0,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3],
  fteInterne: [0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2],
  fteAdmin: [0,0,0,3,4,5,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,9,9,9,9,9,9,9,9,9,9,9,9],
  fteTotal: [0,0,1,3,6,8,10,11,11,11,11,11,13,13,13,13,13,13,13,13,13,13,14,14,16,17,17,17,17,17,17,17,17,17,17,17],
  consultDay: 16,
  fee: 225,
  daysYear: 215,
  revSpec: 923432,
  capex: 523000,
};

// ===== Excel Row Mappings =====

export const EXCEL_ROW_MAP = {
  ca: 46,
  caAssoc: 42,
  caIndep: 43,
  caInterne: 44,
  caSage: 45,
  result: 86,
  cashflow: 87,
  treso1m: 90,
  treso3m: 93,
  admin: 61,
  opex: 76,
  lab: 82,
  fteAssoc: 31,
  fteIndep: 32,
  fteInterne: 33,
  fteAdmin: 35,
  fteAdminExtra: 36,
  fteTotal: 38,
} as const;

export const EXCEL_SCALAR_MAP = {
  consultDay: { row: 5, col: 2 },
  fee: { row: 9, col: 2 },
  daysYear: { row: 8, col: 2 },
  revSpec: { row: 15, col: 2 },
  capex: { row: 118, col: 5 },
} as const;

// Month column indices in Excel (B-M=Y1, O-Z=Y2, AB-AM=Y3)
export function getExcelMonthColumns(): number[] {
  const cols: number[] = [];
  for (let c = 2; c <= 13; c++) cols.push(c);
  for (let c = 15; c <= 26; c++) cols.push(c);
  for (let c = 28; c <= 39; c++) cols.push(c);
  return cols;
}
